- name: create directory for tests
  file:
    path: "{{nagios_tests_dir}}"
    state: directory
    mode: 0775
    owner: nagios
    group: nagios

- name: add contacts
  template:
    src: contacts.cfg.j2
    dest: "{{nagios_tests_dir}}/contacts.cfg"
    group: nagios
    owner: nagios
    mode: 0664
  notify: reload nagios

- name: add services by groups
  template:
    src: host_group_services.cfg.j2
    dest: "{{nagios_tests_dir}}/host_group_{{ item }}.cfg"
    group: nagios
    owner: nagios
    mode: 0664
  when: (item not in ['all', 'ungrouped']) and (groups[item] | count > 0)
  with_items: "{{groups}}"
  notify: reload nagios

- name: add hosts
  template:
    src: host_services.cfg.j2
    dest: "{{nagios_tests_dir}}/host_{{ item }}.cfg"
    group: nagios
    owner: nagios
    mode: 0664
  with_items: "{{groups['all']}}"
  notify: reload nagios
